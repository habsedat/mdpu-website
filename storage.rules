rules_version = '2';

// Craft rules based on data in your Firestore database
// allow write: if firestore.get(
//    /databases/(default)/documents/users/$(request.auth.uid)).data.isAdmin == true;
service firebase.storage {
  match /b/{bucket}/o {
    // News videos - allow admin upload, public read
    match /news-videos/{allPaths=**} {
      allow read: if true; // Public can view news videos
      allow write: if request.auth != null && 
                      (request.auth.token.get('role', '') == 'admin' || 
                       request.auth.token.get('role', '') == 'superadmin' ||
                       request.auth.uid == 'cE2LxjTCDTWDxesSYHtLN9sTnpn1'); // Your admin UID
    }
    
    // Profile pictures - allow user upload for their own profile
    match /profile-pictures/{userId}/{allPaths=**} {
      allow read: if true; // Public can view profile pictures
      allow write: if request.auth != null && 
                      (request.auth.uid == userId || 
                       request.auth.token.get('role', '') == 'admin');
    }
    
    // General media uploads - admin only
    match /media/{allPaths=**} {
      allow read: if true; // Public can view media
      allow write: if request.auth != null && 
                      (request.auth.token.get('role', '') == 'admin' || 
                       request.auth.token.get('role', '') == 'superadmin');
    }
    
    // Project covers and event thumbnails - admin only
    match /project-covers/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null && 
                      (request.auth.token.get('role', '') == 'admin' || 
                       request.auth.token.get('role', '') == 'superadmin');
    }
    
    match /event-thumbnails/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null && 
                      (request.auth.token.get('role', '') == 'admin' || 
                       request.auth.token.get('role', '') == 'superadmin');
    }
  }
}